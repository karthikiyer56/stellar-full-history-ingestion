# Stellar Go SDK: LedgerBackend Interface and Implementations

The `LedgerBackend` interface in `github.com/stellar/go-stellar-sdk/ingest/ledgerbackend` is the core abstraction for accessing Stellar ledger data. It returns `xdr.LedgerCloseMeta` - the metadata structure emitted when each ledger closes.

## Interface Definition
```go
type LedgerBackend interface {
    GetLatestLedgerSequence(ctx context.Context) (sequence uint32, err error)
    GetLedger(ctx context.Context, sequence uint32) (xdr.LedgerCloseMeta, error)
    PrepareRange(ctx context.Context, ledgerRange Range) error
    IsPrepared(ctx context.Context, ledgerRange Range) (bool, error)
    Close() error
}
```

The `Range` type supports `BoundedRange(from, to)`, `UnboundedRange(from)`, and `SingleLedgerRange(ledger)`.

---

## Implementation 1: CaptiveStellarCore

Spawns a `stellar-core` binary as a subprocess and streams `LedgerCloseMeta` via a named pipe (FIFO).

**Key internals:**
- Uses `stellarCoreRunner` internally to manage the subprocess lifecycle
- Communication happens through a filesystem named pipe created in a temporary directory
- Supports two modes:
    - **Catchup mode** (BoundedRange): Replays ledgers in-memory
    - **Live mode** (UnboundedRange): Syncs to a ledger then follows the network
- Small internal buffer (~20 ledgers) - stellar-core pauses if consumer doesn't read fast enough
- Not thread-safe except for `Close()`

**Constructor:**
```go
func NewCaptive(config CaptiveCoreConfig) (*CaptiveStellarCore, error)
```

---

## Implementation 2: BufferedStorageBackend

Reads pre-exported `LedgerCloseMeta` from cloud object storage (GCS or S3) - no stellar-core binary required.

**Key internals:**
- Reads files generated by Galexie (Stellar's ledger exporter)
- Uses a `datastore.DataStore` interface for storage abstraction
- Configurable worker pool for concurrent fetches
- Built-in retry logic for transient failures

**Configuration struct:**
```go
type BufferedStorageBackendConfig struct {
    BufferSize uint32
    NumWorkers uint32
    RetryLimit uint32
    RetryWait  time.Duration
}
```

**Constructor:**
```go
func NewBufferedStorageBackend(
    config BufferedStorageBackendConfig,
    dataStore datastore.DataStore,
    schema datastore.DataStoreSchema,
) (*BufferedStorageBackend, error)
```

**Helper for default config:**
```go
func DefaultBufferedStorageBackendConfig(ledgersPerFile uint32) BufferedStorageBackendConfig
```

---

Both implementations satisfy the same `LedgerBackend` interface and are interchangeable.